
1. 隱藏面板後可以用**快捷鍵**再打開/切換：

* `Ctrl/⌘ + Shift + P` → 顯示/隱藏控制面板
* `Ctrl/⌘ + Shift + 0` → 強制顯示面板

2. 隱藏面板後讓內容**透明、零邊距**，並調整高度算法避免**底部留白**，與 Notion 原生區塊更貼合。

---

## 1. 在現有 `<style>` 結尾加入這段（CSS）

放在你主樣式塊的最後（`</style>` 之前）：

```css
/* 隱藏面板時的無縫嵌入樣式 */
.ui-hidden .panel{ display:none !important; }
.ui-hidden #content{ padding:0 !important; background:transparent !important; }
.ui-hidden .wrap{ padding:0 !important; box-shadow:none !important; background:transparent !important; border:none !important; }

/* 有助 Notion 計算內嵌高度 */
html, body { height:auto; }
```

效果：只要 `<body>` 有 `ui-hidden` 類別，面板會消失、內容區零內距且透明，避免 Notion 外框與內文之間出現白邊/留白。

---

## 2. 在 `applyFromParams()` 中加上 `ui-hidden` 的處理（JS）

找到你的 `function applyFromParams(){ ... }`，在最前面的 `const ui = params.get('ui');` 之後，加入/替換為（保持其他既有邏輯不變）：

```js
const ui = params.get('ui');
if (ui === '0') {
  $('#controls').classList.add('hidden');
  document.body.classList.add('ui-hidden');
} else {
  document.body.classList.remove('ui-hidden');
}
```

> 如此當 URL 參數 `ui=0`（或你按鈕把面板關掉）時，會自動切到無縫嵌入樣式。

---

## 3. 改寫「隱藏面板」按鈕行為（JS）

找到原本這行監聽器：

```js
$('#toggleUi').addEventListener('click', ()=>{
  $('#controls').classList.toggle('hidden');
  syncUrl();
  tickResize();
});
```

**替換**成下面這段（並在同一區塊上方一起放入 `togglePanel()` 函式）：

```js
function togglePanel(){
  const controls = $('#controls');
  const hidden = controls.classList.toggle('hidden');
  document.body.classList.toggle('ui-hidden', hidden);
  syncUrl();
  tickResize();
}
$('#toggleUi').addEventListener('click', togglePanel);
```

---

## 4. 加上全局快捷鍵（JS）

在你的初始化區塊附近（`setupIconGate(); applyFromParams();` 之後也可），加入：

```js
// 快捷鍵：Ctrl/⌘ + Shift + P 切換面板；Ctrl/⌘ + Shift + 0 強制顯示
document.addEventListener('keydown', (e)=>{
  const key = (e.key || '').toLowerCase();
  const mod = e.ctrlKey || e.metaKey;
  if (mod && e.shiftKey && key === 'p') {
    e.preventDefault();
    togglePanel();
  }
  if (mod && e.shiftKey && key === '0') {
    e.preventDefault();
    if ($('#controls').classList.contains('hidden')) togglePanel();
  }
});
```

---

## 5. 修正高度計算，避免底部留白（JS）

把你原本這段高度邏輯（`tickResize()` + `MutationObserver` + `resize` 監聽）**替換**為下面版本。核心差異：改由**目前可見容器**計算高度（Icon Gate 或 Editor Container），避免隱藏面板仍被計入高度。

```js
let resizeTimer;

function currentContainer(){
  const gateVisible = !$('#gate').classList.contains('hidden');
  return gateVisible ? $('#gate') : $('#editorContainer');
}

function tickResize(){
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=>{
    const target = currentContainer();
    const h = Math.max(1, target.scrollHeight);
    document.body.style.height = h + 'px';
    document.documentElement.style.height = h + 'px';
  }, 50);
}

// 監看整個編輯容器（含內容/切換模式）
const obs = new MutationObserver(tickResize);
obs.observe($('#editorContainer'), {childList:true, subtree:true, characterData:true});

window.addEventListener('resize', tickResize);
```

> 舊版若持續觀察 `#content`，在 panel 隱藏或切換 Gate/Editor 容器時，容易出現高度沒有及時收斂的情況；改觀察 `#editorContainer` 並用 `currentContainer()` 判斷可見容器能修正這個問題。

---

## 驗證清單

* 載入帶 `?ui=0` 的連結：面板不顯示、內容透明且緊貼 Notion，無底部多餘留白。
* 在嵌入框中按 `Ctrl/⌘ + Shift + P` 能切出/切入面板。
* 切換不同模式或文字長度，高度隨內容變化，沒有殘留空白。