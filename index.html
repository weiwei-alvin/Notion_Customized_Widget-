<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notion ä¸­æ–‡å­—é«” & Callout Widget</title>
  <!-- Google Fontsï¼šç¹ä¸­å¯ç”¨å­—é«” -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@400;600;700&family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
  <style>
    :root{
      --font: 'Noto Sans TC', system-ui, -apple-system, 'Segoe UI', Roboto, 'PingFang TC', 'Microsoft JhengHei', sans-serif;
      --size: 18px;
      --weight: 500;
      --text: #111111;
      --bg: transparent; /* èˆ‡ Notion èåˆ */
      --radius: 12px;
      --padding: 16px;
      --line: 1.55;
      --align: left;
      --accent: #8b5cf6; /* callout é‚Šæ¢èˆ‡åœ–ç¤ºé¡è‰² */
      --shadow: 0 0 0 rgba(0,0,0,0);
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg);}

    .wrap{
      font-family: var(--font);
      font-size: var(--size);
      font-weight: var(--weight);
      color: var(--text);
      border-radius: var(--radius);
      padding: var(--padding);
      line-height: var(--line);
      text-align: var(--align);
      box-shadow: var(--shadow);
      word-break: break-word;
    }

    /* æ¨¡æ“¬ Notion Callout æ¨£å¼ */
    .callout{
      display:grid;
      grid-template-columns: auto 1fr;
      gap:12px;
      align-items:flex-start;
      border:1px solid color-mix(in oklab, var(--accent) 35%, #0000 65%);
      background: color-mix(in oklab, var(--accent) 6%, var(--bg) 94%);
    }
    .callout::before{
      content: var(--icon, '\"ğŸ’¡\"');
      display:block;
      font-size: 1.2em;
      line-height:1;
      padding-top:2px;
      color: var(--accent);
    }
    .strip{ border-left: 6px solid var(--accent); }

    /* å…§å»ºæ§åˆ¶é¢æ¿ï¼ˆå¯ç”¨ &ui=0 é—œé–‰ï¼‰ */
    .panel{ position:sticky; top:0; inset-inline:0; background:#fff; border-bottom:1px solid #eee; padding:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; z-index:2 }
    .panel label{ font: 12px/1.2 ui-sans-serif, system-ui; color:#666 }
    .panel input[type="text"], .panel input[type="number"], .panel input[type="color"], .panel select{ font: 12px/1.2 ui-sans-serif, system-ui; padding:6px 8px; border:1px solid #ddd; border-radius:8px }
    .panel .spacer{ flex:1 }
    .panel .btn{ padding:8px 10px; border-radius:8px; border:1px solid #ddd; background:#fafafa; cursor:pointer }

    /* è®“ Notion å¯ç”¨ã€ŒResize to fitã€æ™‚é«˜åº¦å‰›å¥½ */
    #content{ padding: 8px }
    .hidden{ display:none !important }
  .gate{position:relative;}
.gate.hidden{display:none}
.gate{display:grid;place-items:center;height:320px}
.gate-card{display:grid;gap:12px;place-items:center;border:1px dashed #ddd;padding:24px;border-radius:16px;background:color-mix(in oklab, var(--accent) 6%, #fff 94%)}
.gate-card img{display:block;width:96px;height:96px;object-fit:contain;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08)}
.gate-title{font:600 16px/1.4 ui-sans-serif,system-ui;color:#475569}
</style>
  <!-- è‡ªå¸¶å­—é«”ï¼šè«‹ç¢ºèª /assets/Fonts å…§å«ä¸‹åˆ—æª”æ¡ˆï¼Œä¸¦æ³¨æ„æˆæ¬Š -->
  <style>
    @font-face{font-family:'ChenYuluoyan Thin Mono';src:url('./assets/Fonts/ChenYuluoyan-Thin-Monospaced.ttf') format('truetype');font-display:swap}
    @font-face{font-family:'cwTeX Fangsong';src:url('./assets/Fonts/cwtexq-fangsong-Regular.ttf') format('truetype');font-display:swap}
    @font-face{font-family:'SimFang';src:url('./assets/Fonts/simfang.ttf') format('truetype');font-display:swap}
    @font-face{font-family:'STFangsong';src:url('./assets/Fonts/STFANGSO.TTF') format('truetype');font-display:swap}
    @font-face{font-family:'ToneOZ Tsuipita TC';src:url('./assets/Fonts/ToneOZ-Tsuipita-TC.ttf') format('truetype');font-display:swap}
    @font-face{font-family:'WangHanZong YanKai';src:url('./assets/Fonts/ç‹æ±‰å®—é¡æ¥·ä½“ç¹.ttf') format('truetype');font-display:swap}
    /* æ³¨æ„ï¼š.ttc åœ¨éƒ¨åˆ†ç€è¦½å™¨ç›¸å®¹æ€§è¼ƒå·®ï¼Œå»ºè­°è½‰æˆ .woff2ï¼.ttf */
    @font-face{font-family:'Microsoft JhengHei';src:url('./assets/Fonts/å¾®è»Ÿæ­£é»‘é«”/msjh.ttc') format('truetype');font-display:swap}
  </style>
</head>
<body>
    <div id="controls" class="panel">
    <label>æ¨¡å¼
      <select id="mode">
        <option value="plain">ç´”æ–‡å­—</option>
        <option value="callout">Callout</option>
        <option value="strip">å·¦é‚Šè‰²æ¢</option>
      </select>
    </label>
    <label>å­—é«”
      <select id="font">
        <option value="Noto Sans TC">Noto Sans TC</option>
        <option value="Noto Serif TC">Noto Serif TC</option>
        <option value="LXGW WenKai TC">LXGW WenKai TCï¼ˆéœé¶©æ–‡æ¥·ï¼‰</option>
        <option value="ChenYuluoyan Thin Mono">ChenYuluoyan Thin Mono</option>
        <option value="cwTeX Fangsong">cwTeX Fangsong</option>
        <option value="SimFang">SimFang</option>
        <option value="STFangsong">STFangsong</option>
        <option value="ToneOZ Tsuipita TC">ToneOZ Tsuipita TC</option>
        <option value="WangHanZong YanKai">WangHanZong YanKai</option>
        <option value="Microsoft JhengHei">Microsoft JhengHeiï¼ˆå¯èƒ½éœ€è½‰æª”ï¼‰</option>
      </select>
    </label>
    <label>å¤§å° <input id="size" type="number" min="10" max="96" step="1" value="18"> px</label>
    <label>ç²—ç´° <input id="weight" type="number" min="100" max="900" step="100" value="500"></label>
    <label>æ–‡å­—è‰² <input id="text" type="color" value="#111111"></label>
    <label>é‡é»è‰² <input id="accent" type="color" value="#8b5cf6"></label>
    <label>èƒŒæ™¯è‰² <input id="bg" type="text" value="transparent" placeholder="#FFFFFF æˆ– transparent"></label>
    <label>åœ“è§’ <input id="radius" type="number" min="0" max="48" value="12"> px</label>
    <label>è¡Œè· <input id="line" type="number" step="0.05" min="1" max="2.2" value="1.55"></label>
    <div class="spacer"></div>
    <button class="btn" id="copyUrl">è¤‡è£½è¨­å®šé€£çµ</button>
    <button class="btn" id="toggleUi">éš±è—é¢æ¿</button>
  </div>

  <!-- é¦–å± ICON Gateï¼ˆé»æ“Šåœ–ç¤ºé€²å…¥ç·¨è¼¯å™¨ï¼‰ -->
  <div id="gate" class="gate hidden">
    <div class="gate-card">
      <img id="gateIcon" alt="widget icon"/>
      <div id="gateTitle" class="gate-title">é»ä¸€ä¸‹é–‹å§‹ç·¨è¼¯</div>
    </div>
  </div>

  <div id="content" class="wrap" contenteditable="true" spellcheck="false">åœ¨é€™è£¡è¼¸å…¥ä½ çš„å…§å®¹ã€‚ä½ å¯ä»¥æŠŠæ•´å€‹é é¢ä»¥ã€ŒåµŒå…¥ã€æ”¾å…¥ Notionï¼Œç•¶ä½œå¯æ›å­—é«”çš„ callout æˆ–æ¨™é¡Œå¡ç‰‡ä½¿ç”¨ã€‚</div> class="wrap" contenteditable="true" spellcheck="false">åœ¨é€™è£¡è¼¸å…¥ä½ çš„å…§å®¹ã€‚ä½ å¯ä»¥æŠŠæ•´å€‹é é¢ä»¥ã€ŒåµŒå…¥ã€æ”¾å…¥ Notionï¼Œç•¶ä½œå¯æ›å­—é«”çš„ callout æˆ–æ¨™é¡Œå¡ç‰‡ä½¿ç”¨ã€‚</div>

  <script>
    // å·¥å…·ï¼šè®€å–/å¯«å…¥ URL åƒæ•¸
    const $ = (s)=>document.querySelector(s);
    const params = new URLSearchParams(location.search);

    // Gate åˆå§‹ï¼šè‹¥æä¾› iconUrlï¼Œé è¨­é¡¯ç¤ºé¦–å± ICON Gate
    function setupGateFromParams(){
      const iconUrl = params.get('iconUrl');
      const gate = params.get('gate'); // '1' é¡¯ç¤ºï¼Œ'0' é—œé–‰
      const title = params.get('title') || 'é»ä¸€ä¸‹é–‹å§‹ç·¨è¼¯';
      const gateEl = document.getElementById('gate');
      const iconEl = document.getElementById('gateIcon');
      const titleEl = document.getElementById('gateTitle');
      titleEl.textContent = title;
      if(iconUrl && gate !== '0'){
        iconEl.src = iconUrl;
        gateEl.classList.remove('hidden');
        document.getElementById('content').style.display = 'none';
        document.getElementById('controls').style.display = params.get('ui')==='0' ? 'none':'flex';
        gateEl.addEventListener('click', ()=>{
          gateEl.classList.add('hidden');
          document.getElementById('content').style.display = '';
          tickResize();
        });
      }
    }

    function applyFromParams(){
      const ui = params.get('ui');
      if(ui === '0') $('#controls').classList.add('hidden');

      const font = params.get('font') || getCSS('--font').replace(/^["']|["']$/g,'');
      const size = params.get('size') || '18';
      const weight = params.get('weight') || '500';
      const text = params.get('text') || '#111111';
      const bg = params.get('bg') || 'transparent';
      const radius = params.get('radius') || '12';
      const line = params.get('line') || '1.55';
      const align = params.get('align') || 'left';
      const accent = params.get('accent') || '#8b5cf6';
      const mode = params.get('mode') || 'plain';
      const shadow = params.get('shadow') === '1' ? '0 6px 24px rgba(0,0,0,.08)' : '0 0 0 rgba(0,0,0,0)';
      const textContent = params.get('textContent');
      const icon = params.get('icon') || 'ğŸ’¡';

      setCSS('--font', font);
      setCSS('--size', size+"px");
      setCSS('--weight', weight);
      setCSS('--text', text);
      setCSS('--bg', bg);
      setCSS('--radius', radius+"px");
      setCSS('--line', line);
      setCSS('--align', align);
      setCSS('--accent', accent);
      setCSS('--shadow', shadow);
      document.documentElement.style.setProperty('--icon', `'"${icon}"'`);

      const c = $('#content');
      c.classList.remove('callout','strip');
      if(mode==='callout') c.classList.add('callout');
      if(mode==='strip') c.classList.add('strip');

      if(textContent) c.innerText = decodeURIComponent(textContent);

      $('#font').value = font;
      $('#size').value = Number(size);
      $('#weight').value = Number(weight);
      $('#text').value = toColor(text);
      $('#bg').value = bg;
      $('#radius').value = Number(radius);
      $('#line').value = Number(line);
      $('#accent').value = toColor(accent);
      $('#mode').value = mode;

      tickResize();
      setupGateFromParams();
    }

    function getCSS(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
    function setCSS(name, value){ document.documentElement.style.setProperty(name, value); }

    function toColor(v){
      // å°‡ä»»ä½•åˆæ³•é¡è‰²è½‰ç‚º hexï¼ˆè‹¥é€æ˜æˆ–é hexï¼Œfallback åŸå­—ä¸²ï¼‰
      if(v === 'transparent') return '#000000';
      const d = document.createElement('div');
      d.style.color = v; document.body.appendChild(d);
      const rgb = getComputedStyle(d).color; d.remove();
      const m = rgb.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
      if(!m) return v; // å¯èƒ½æ˜¯ oklch / lab ç­‰
      const [r,g,b] = m.slice(1).map(Number);
      return '#' + [r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
    }

    // æ§åˆ¶é¢æ¿äº‹ä»¶
    const map = {
      font: v=> setCSS('--font', v),
      size: v=> setCSS('--size', v+'px'),
      weight: v=> setCSS('--weight', v),
      text: v=> setCSS('--text', v),
      bg: v=> setCSS('--bg', v),
      radius: v=> setCSS('--radius', v+'px'),
      line: v=> setCSS('--line', v),
      accent: v=> setCSS('--accent', v),
      mode: v=> { $('#content').classList.remove('callout','strip'); if(v==='callout') $('#content').classList.add('callout'); if(v==='strip') $('#content').classList.add('strip'); }
    };

    document.addEventListener('input', (e)=>{
      const id = e.target.id; if(!(id in map)) return; map[id](e.target.value); syncUrl(); tickResize();
    });
    $('#toggleUi').addEventListener('click', ()=>{ $('#controls').classList.toggle('hidden'); syncUrl(); tickResize(); });
    $('#copyUrl').addEventListener('click', ()=>{ navigator.clipboard.writeText(location.href).then(()=>{ alert('å·²è¤‡è£½é€£çµï¼Œå¯ç›´æ¥åµŒå…¥ Notionï¼'); }); });

    function syncUrl(){
      const q = new URLSearchParams();
      q.set('font', $('#font').value);
      q.set('size', $('#size').value);
      q.set('weight', $('#weight').value);
      q.set('text', $('#text').value);
      q.set('bg', $('#bg').value);
      q.set('radius', $('#radius').value);
      q.set('line', $('#line').value);
      q.set('accent', $('#accent').value);
      q.set('mode', $('#mode').value);
      q.set('ui', $('#controls').classList.contains('hidden') ? '0' : '1');
      q.set('textContent', encodeURIComponent($('#content').innerText));
      // è‹¥ä½¿ç”¨ ICON gateï¼Œä¹Ÿä¿ç•™åƒæ•¸
      ['iconUrl','gate','title'].forEach(k=>{ const v = params.get(k); if(v!==null) q.set(k,v); });
      history.replaceState(null, '', '?' + q.toString());
    }

    // è‡ªå‹•èª¿æ•´é«˜åº¦ï¼ˆå¹«åŠ© Notion çš„ã€ŒResize to fitã€ï¼‰
    let resizeTimer;
    function tickResize(){
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(()=>{
        document.body.style.height = 'auto';
        document.body.style.height = document.documentElement.scrollHeight + 'px';
      }, 50);
    }
    const obs = new MutationObserver(tickResize);
    obs.observe($('#content'), {childList:true, subtree:true, characterData:true});
    window.addEventListener('resize', tickResize);

    // åˆå§‹åŒ–
    applyFromParams();
    tickResize();
  </script>
</body>
</html>
